{"version":3,"sources":["../../src/oracle/select2.js"],"names":["async","require","oracledb","dbConfig","doconnect","cb","getConnection","user","password","connectString","dorelease","conn","close","err","console","error","message","doquery_array","sql","execute","result","log","rows","doquery_object","outFormat","OBJECT","waterfall"],"mappings":";;AAAA,IAAIA,QAAQC,QAAQ,OAAR,CAAZ;AACA,IAAIC,WAAWD,QAAQ,UAAR,CAAf;AACA,IAAIE,WAAWF,QAAQ,eAAR,CAAf;;AAEA,IAAIG,YAAY,SAAZA,SAAY,CAAUC,EAAV,EAAc;AAC1BH,aAASI,aAAT,CACI;AACIC,cAAMJ,SAASI,IADnB;AAEIC,kBAAUL,SAASK,QAFvB;AAGIC,uBAAeN,SAASM;AAH5B,KADJ,EAMIJ,EANJ;AAOH,CARD;;AAUA,IAAIK,YAAY,SAAZA,SAAY,CAAUC,IAAV,EAAgB;AAC5BA,SAAKC,KAAL,CAAW,UAAUC,GAAV,EAAe;AACtB,YAAIA,GAAJ,EACIC,QAAQC,KAAR,CAAcF,IAAIG,OAAlB;AACP,KAHD;AAIH,CALD;;AAOA;AACA,IAAIC,gBAAgB,SAAhBA,aAAgB,CAAUN,IAAV,EAAgBN,EAAhB,EAAoB;AACpC,QAAIa,MAAM,uCACN,4BADM,GAEN,iCAFM,GAGN,kCAHM,GAIN,kCAJM,GAKN,sBALM,GAMN,kBANM,GAON,gEAPM,GAQN,wBARM,GASN,gCATM,GAUN,+BAVM,GAWN,yBAXM,GAYN,sDAZM,GAaN,sDAbM,GAcN,kDAdM,GAeN,+BAfJ;AAgBAP,SAAKQ,OAAL,CACID,GADJ,EAEI,UAAUL,GAAV,EAAeO,MAAf,EAAuB;AACnB,YAAIP,GAAJ,EAAS;AACL,mBAAOR,GAAGQ,GAAH,EAAQF,IAAR,CAAP;AACH,SAFD,MAEO;AACHG,oBAAQO,GAAR,CAAY,wEAAZ;AACAP,oBAAQO,GAAR,CAAYD,OAAOE,IAAnB;AACA,mBAAOjB,GAAG,IAAH,EAASM,IAAT,CAAP;AACH;AACJ,KAVL;AAWH,CA5BD;;AA8BA;AACA,IAAIY,iBAAiB,SAAjBA,cAAiB,CAAUZ,IAAV,EAAgBN,EAAhB,EAAoB;AACrC,QAAIa,MAAM,gDACN,4BADM,GAEN,iCAFM,GAGN,kCAHM,GAIN,kCAJM,GAKN,sBALM,GAMN,kBANM,GAON,gEAPM,GAQN,wBARM,GASN,gCATM,GAUN,+BAVM,GAWN,yBAXM,GAYN,oDAZM,GAaN,oDAbM,GAcN,kDAdM,GAeN,+BAfJ;AAgBAP,SAAKQ,OAAL,CACID,GADJ,EAEI,EAFJ,EAEQ;AACJ;AACA,MAACM,WAAWtB,SAASuB,MAArB,EAJJ,EAIkC;AAC9B,cAAUZ,GAAV,EAAeO,MAAf,EAAuB;AACnB,YAAIP,GAAJ,EAAS;AACL,mBAAOR,GAAGQ,GAAH,EAAQF,IAAR,CAAP;AACH,SAFD,MAEO;AACHG,oBAAQO,GAAR,CAAY,iEAAZ;AACAP,oBAAQO,GAAR,CAAYD,OAAOE,IAAnB;AACA,mBAAOjB,GAAG,IAAH,EAASM,IAAT,CAAP;AACH;AACJ,KAbL;AAcH,CA/BD;;AAiCAX,MAAM0B,SAAN,CACI,CACItB,SADJ,EAEIa,aAFJ,CADJ,EAMI,UAAUJ,GAAV,EAAeF,IAAf,EAAqB;AACjB,QAAIE,GAAJ,EAAS;AACLC,gBAAQC,KAAR,CAAc,4BAAd,EAA4CF,GAA5C,EAAiD,KAAjD;AACH;AACD,QAAIF,IAAJ,EACID,UAAUC,IAAV;AACP,CAZL","file":"select2.js","sourcesContent":["var async = require('async');\r\nvar oracledb = require('oracledb');\r\nvar dbConfig = require('./dbconfig.js');\r\n\r\nvar doconnect = function (cb) {\r\n    oracledb.getConnection(\r\n        {\r\n            user: dbConfig.user,\r\n            password: dbConfig.password,\r\n            connectString: dbConfig.connectString\r\n        },\r\n        cb);\r\n};\r\n\r\nvar dorelease = function (conn) {\r\n    conn.close(function (err) {\r\n        if (err)\r\n            console.error(err.message);\r\n    });\r\n};\r\n\r\n// Default Array Output Format\r\nvar doquery_array = function (conn, cb) {\r\n    var sql = 'select t.docdate AS \"Дата ED274\", ' +\r\n        't.opernum AS \"Код ED273\", ' +\r\n        'p.docdate AS \"Дата документа\", ' +\r\n        'p.docnum  AS \"Номер документа\", ' +\r\n        'p.paysum  AS \"Сумма документа\", ' +\r\n        'i.ed244_answercode, ' +\r\n        'i.ed244_purpose ' +\r\n        'FROM ESIDMESSAGE t, esid273doc a, payorder p, inesidmessage i ' +\r\n        \"where t.doctype = 273 \" +\r\n        \"and t.opernum = a.esidopernum \" +\r\n        \"AND p.opernum = a.payopernum \" +\r\n        \"AND i.edtype = 'ED274' \" +\r\n        \"and i.eddate >= to_date('01.01.2017', 'mm.dd.yyyy') \" +\r\n        \"and i.eddate <= to_date('02.01.2017', 'mm.dd.yyyy') \" +\r\n        \"AND MOD(i.ed243_edno / 1000, 1) * 1000 = a.edno \" +\r\n        \"AND i.ed243_eddate = a.eddate\";\r\n    conn.execute(\r\n        sql,\r\n        function (err, result) {\r\n            if (err) {\r\n                return cb(err, conn);\r\n            } else {\r\n                console.log(\"----- Cities beginning with 'S' (default ARRAY output format) --------\");\r\n                console.log(result.rows);\r\n                return cb(null, conn);\r\n            }\r\n        });\r\n};\r\n\r\n// Optional Object Output Format\r\nvar doquery_object = function (conn, cb) {\r\n    var sql = 'select t.docdate          AS \"Дата ED274\", ' +\r\n        't.opernum AS \"Код ED273\", ' +\r\n        'p.docdate AS \"Дата документа\", ' +\r\n        'p.docnum  AS \"Номер документа\", ' +\r\n        'p.paysum  AS \"Сумма документа\", ' +\r\n        'i.ed244_answercode, ' +\r\n        'i.ed244_purpose ' +\r\n        'FROM ESIDMESSAGE t, esid273doc a, payorder p, inesidmessage i ' +\r\n        'where t.doctype = 273 ' +\r\n        'and t.opernum = a.esidopernum ' +\r\n        'AND p.opernum = a.payopernum ' +\r\n        \"AND i.edtype = 'ED274' \" +\r\n        \"and i.eddate >= to_date('01.01.17', 'dd.mm.yyyy') \" +\r\n        \"and i.eddate <= to_date('02.01.17', 'dd.mm.yyyy') \" +\r\n        'AND MOD(i.ed243_edno / 1000, 1) * 1000 = a.edno ' +\r\n        'AND i.ed243_eddate = a.eddate';\r\n    conn.execute(\r\n        sql,\r\n        {}, // A bind variable parameter is needed to disambiguate the following options parameter\r\n        // otherwise you will get Error: ORA-01036: illegal variable name/number\r\n        {outFormat: oracledb.OBJECT}, // outFormat can be OBJECT or ARRAY.  The default is ARRAY\r\n        function (err, result) {\r\n            if (err) {\r\n                return cb(err, conn);\r\n            } else {\r\n                console.log(\"----- Cities beginning with 'S' (OBJECT output format) --------\");\r\n                console.log(result.rows);\r\n                return cb(null, conn);\r\n            }\r\n        });\r\n};\r\n\r\nasync.waterfall(\r\n    [\r\n        doconnect,\r\n        doquery_array,\r\n        // doquery_object\r\n    ],\r\n    function (err, conn) {\r\n        if (err) {\r\n            console.error(\"In waterfall error cb: ==>\", err, \"<==\");\r\n        }\r\n        if (conn)\r\n            dorelease(conn);\r\n    }\r\n);\r\n"]}