{"version":3,"sources":["../../src/oracle/resultset1.js"],"names":["oracledb","require","dbConfig","rowCount","getConnection","user","password","connectString","err","connection","console","error","message","sql","execute","resultSet","result","doRelease","fetchOneRowFromRS","getRow","row","doClose","log","close"],"mappings":";;AAAA;;AAEA;;;;;;;;;;;;;;;;;;;;;;;;AAwBA,IAAIA,WAAWC,QAAQ,UAAR,CAAf;AACA,IAAIC,WAAWD,QAAQ,eAAR,CAAf;;AAEA,IAAIE,WAAW,CAAf;;AAEAH,SAASI,aAAT,CACI;AACIC,UAAMH,SAASG,IADnB;AAEIC,cAAUJ,SAASI,QAFvB;AAGIC,mBAAeL,SAASK;AAH5B,CADJ,EAMI,UAAUC,GAAV,EAAeC,UAAf,EAA2B;AACvB,QAAID,GAAJ,EAAS;AACLE,gBAAQC,KAAR,CAAcH,IAAII,OAAlB;AACA;AACH;AACD,QAAIC,MAAM,uCACN,4BADM,GAEN,iCAFM,GAGN,kCAHM,GAIN,kCAJM,GAKN,sBALM,GAMN,kBANM,GAON,gEAPM,GAQN,wBARM,GASN,gCATM,GAUN,+BAVM,GAWN,yBAXM,GAYN,sDAZM,GAaN,sDAbM,GAcN,kDAdM,GAeN,+BAfJ;AAgBAJ,eAAWK,OAAX,CACID,GADJ,EAEI,EAFJ,EAEQ;AACJ,MAACE,WAAW,IAAZ,EAHJ,EAGuB;AACnB,cAAUP,GAAV,EAAeQ,MAAf,EAAuB;AACnB,YAAIR,GAAJ,EAAS;AACLE,oBAAQC,KAAR,CAAcH,IAAII,OAAlB;AACAK,sBAAUR,UAAV;AACA;AACH;AACD;AACAS,0BAAkBT,UAAlB,EAA8BO,OAAOD,SAArC;AACH,KAZL;AAaH,CAxCL;;AA0CA,SAASG,iBAAT,CAA2BT,UAA3B,EAAuCM,SAAvC,EAAkD;AAC9CA,cAAUI,MAAV,EAAkB;AACd,cAAUX,GAAV,EAAeY,GAAf,EAAoB;AAChB,YAAIZ,GAAJ,EAAS;AACLE,oBAAQC,KAAR,CAAcH,IAAII,OAAlB;AACAS,oBAAQZ,UAAR,EAAoBM,SAApB,EAFK,CAE2B;AACnC,SAHD,MAGO,IAAI,CAACK,GAAL,EAAU;AAAiB;AAC9BC,oBAAQZ,UAAR,EAAoBM,SAApB,EADa,CACmB;AACnC,SAFM,MAEA;AACHZ;AACAO,oBAAQY,GAAR,CAAY,8BAA8BnB,QAA1C;AACAO,oBAAQY,GAAR,CAAYF,GAAZ;AACAF,8BAAkBT,UAAlB,EAA8BM,SAA9B;AACH;AACJ,KAbL;AAcH;;AAED,SAASE,SAAT,CAAmBR,UAAnB,EAA+B;AAC3BA,eAAWc,KAAX,CACI,UAAUf,GAAV,EAAe;AACX,YAAIA,GAAJ,EAAS;AACLE,oBAAQC,KAAR,CAAcH,IAAII,OAAlB;AACH;AACJ,KALL;AAMH;;AAED,SAASS,OAAT,CAAiBZ,UAAjB,EAA6BM,SAA7B,EAAwC;AACpCA,cAAUQ,KAAV,CACI,UAAUf,GAAV,EAAe;AACX,YAAIA,GAAJ,EAAS;AACLE,oBAAQC,KAAR,CAAcH,IAAII,OAAlB;AACH;AACDK,kBAAUR,UAAV;AACH,KANL;AAOH","file":"resultset1.js","sourcesContent":["/* Copyright (c) 2015, 2016, Oracle and/or its affiliates. All rights reserved. */\r\n\r\n/******************************************************************************\r\n *\r\n * You may not use the identified files except in compliance with the Apache\r\n * License, Version 2.0 (the \"License.\")\r\n *\r\n * You may obtain a copy of the License at\r\n * http://www.apache.org/licenses/LICENSE-2.0.\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\r\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n *\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n *\r\n * NAME\r\n *   resultset1.js\r\n *\r\n * DESCRIPTION\r\n *   Executes a query and uses a result set to fetch rows with getRow().\r\n *   Uses Oracle's sample HR schema.\r\n *\r\n *****************************************************************************/\r\n\r\nvar oracledb = require('oracledb');\r\nvar dbConfig = require('./dbconfig.js');\r\n\r\nvar rowCount = 0;\r\n\r\noracledb.getConnection(\r\n    {\r\n        user: dbConfig.user,\r\n        password: dbConfig.password,\r\n        connectString: dbConfig.connectString\r\n    },\r\n    function (err, connection) {\r\n        if (err) {\r\n            console.error(err.message);\r\n            return;\r\n        }\r\n        var sql = 'select t.docdate AS \"Дата ED274\", ' +\r\n            't.opernum AS \"Код ED273\", ' +\r\n            'p.docdate AS \"Дата документа\", ' +\r\n            'p.docnum  AS \"Номер документа\", ' +\r\n            'p.paysum  AS \"Сумма документа\", ' +\r\n            'i.ed244_answercode, ' +\r\n            'i.ed244_purpose ' +\r\n            'FROM ESIDMESSAGE t, esid273doc a, payorder p, inesidmessage i ' +\r\n            \"where t.doctype = 273 \" +\r\n            \"and t.opernum = a.esidopernum \" +\r\n            \"AND p.opernum = a.payopernum \" +\r\n            \"AND i.edtype = 'ED274' \" +\r\n            \"and i.eddate >= to_date('04.01.2017', 'mm.dd.yyyy') \" +\r\n            \"and i.eddate <= to_date('04.30.2017', 'mm.dd.yyyy') \" +\r\n            \"AND a.edno = MOD(i.ed243_edno / 1000, 1) * 1000 \" +\r\n            \"AND i.ed243_eddate = a.eddate\";\r\n        connection.execute(\r\n            sql,\r\n            [], // no bind variables\r\n            {resultSet: true}, // return a result set.  Default is false\r\n            function (err, result) {\r\n                if (err) {\r\n                    console.error(err.message);\r\n                    doRelease(connection);\r\n                    return;\r\n                }\r\n                // console.log(result);\r\n                fetchOneRowFromRS(connection, result.resultSet);\r\n            });\r\n    });\r\n\r\nfunction fetchOneRowFromRS(connection, resultSet) {\r\n    resultSet.getRow( // get one row\r\n        function (err, row) {\r\n            if (err) {\r\n                console.error(err.message);\r\n                doClose(connection, resultSet); // always close the result set\r\n            } else if (!row) {                // no rows, or no more rows\r\n                doClose(connection, resultSet); // always close the result set\r\n            } else {\r\n                rowCount++;\r\n                console.log(\"fetchOneRowFromRS(): row \" + rowCount);\r\n                console.log(row);\r\n                fetchOneRowFromRS(connection, resultSet);\r\n            }\r\n        });\r\n}\r\n\r\nfunction doRelease(connection) {\r\n    connection.close(\r\n        function (err) {\r\n            if (err) {\r\n                console.error(err.message);\r\n            }\r\n        });\r\n}\r\n\r\nfunction doClose(connection, resultSet) {\r\n    resultSet.close(\r\n        function (err) {\r\n            if (err) {\r\n                console.error(err.message);\r\n            }\r\n            doRelease(connection);\r\n        });\r\n}\r\n"]}