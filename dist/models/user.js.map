{"version":3,"sources":["../../src/models/user.js"],"names":["mongoose","require","mongoosePaginate","Schema","bcrypt","userSchema","email","type","String","unique","lowercase","password","pre","next","user","genSalt","err","salt","hash","methods","comparePassword","candidatePassword","callback","compare","isMatch","plugin","ModelClass","model","module","exports"],"mappings":";;AAAA,IAAMA,WAAWC,QAAQ,UAAR,CAAjB;AACA,IAAMC,mBAAmBD,QAAQ,mBAAR,CAAzB;AACA,IAAME,SAASH,SAASG,MAAxB;AACA,IAAMC,SAASH,QAAQ,eAAR,CAAf;;AAEA;AACA,IAAMI,aAAa,IAAIF,MAAJ,CAAW;AAC1BG,WAAO,EAACC,MAAMC,MAAP,EAAeC,QAAQ,IAAvB,EAA6BC,WAAW,IAAxC,EADmB;AAE1BC,cAAUH;AAFgB,CAAX,CAAnB;;AAKA;AACA;AACAH,WAAWO,GAAX,CAAe,MAAf,EAAuB,UAAUC,IAAV,EAAgB;AACnC;AACA,QAAMC,OAAO,IAAb;;AAEA;AACAV,WAAOW,OAAP,CAAe,EAAf,EAAmB,UAAUC,GAAV,EAAeC,IAAf,EAAqB;AACpC,YAAID,GAAJ,EAAS;AACL,mBAAOH,KAAKG,GAAL,CAAP;AACH;;AAED;AACAZ,eAAOc,IAAP,CAAYJ,KAAKH,QAAjB,EAA2BM,IAA3B,EAAiC,IAAjC,EAAuC,UAAUD,GAAV,EAAeE,IAAf,EAAqB;AACxD,gBAAIF,GAAJ,EAAS;AACL,uBAAOH,KAAKG,GAAL,CAAP;AACH;;AAED;AACAF,iBAAKH,QAAL,GAAgBO,IAAhB;AACAL;AACH,SARD;AASH,KAfD;AAgBH,CArBD;;AAuBAR,WAAWc,OAAX,CAAmBC,eAAnB,GAAqC,UAAUC,iBAAV,EAA6BC,QAA7B,EAAuC;AACxElB,WAAOmB,OAAP,CAAeF,iBAAf,EAAkC,KAAKV,QAAvC,EAAiD,UAAUK,GAAV,EAAeQ,OAAf,EAAwB;AACrE,YAAIR,GAAJ,EAAS;AACL,mBAAOM,SAASN,GAAT,CAAP;AACH;;AAEDM,iBAAS,IAAT,EAAeE,OAAf;AACH,KAND;AAOH,CARD;;AAUAnB,WAAWoB,MAAX,CAAkBvB,gBAAlB;;AAEA;AACA,IAAMwB,aAAa1B,SAAS2B,KAAT,CAAe,MAAf,EAAuBtB,UAAvB,CAAnB;;AAEA;AACAuB,OAAOC,OAAP,GAAiBH,UAAjB","file":"user.js","sourcesContent":["const mongoose = require('mongoose');\r\nconst mongoosePaginate = require('mongoose-paginate');\r\nconst Schema = mongoose.Schema;\r\nconst bcrypt = require('bcrypt-nodejs');\r\n\r\n// Define our model\r\nconst userSchema = new Schema({\r\n    email: {type: String, unique: true, lowercase: true},\r\n    password: String\r\n});\r\n\r\n// On Save Hook, encrypt password\r\n// Before saving a model, run this function\r\nuserSchema.pre('save', function (next) {\r\n    // get access to the user model\r\n    const user = this;\r\n\r\n    // generate a salt then run callback\r\n    bcrypt.genSalt(10, function (err, salt) {\r\n        if (err) {\r\n            return next(err);\r\n        }\r\n\r\n        // hash (encrypt) our password using the salt\r\n        bcrypt.hash(user.password, salt, null, function (err, hash) {\r\n            if (err) {\r\n                return next(err);\r\n            }\r\n\r\n            // overwrite plain text password with encrypted password\r\n            user.password = hash;\r\n            next();\r\n        });\r\n    });\r\n});\r\n\r\nuserSchema.methods.comparePassword = function (candidatePassword, callback) {\r\n    bcrypt.compare(candidatePassword, this.password, function (err, isMatch) {\r\n        if (err) {\r\n            return callback(err);\r\n        }\r\n\r\n        callback(null, isMatch);\r\n    });\r\n};\r\n\r\nuserSchema.plugin(mongoosePaginate);\r\n\r\n// Create the model class\r\nconst ModelClass = mongoose.model('user', userSchema);\r\n\r\n// Export the model\r\nmodule.exports = ModelClass;\r\n"]}